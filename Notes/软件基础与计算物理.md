# 软件基础与计算物理

## 数值微分和数值积分

### 数值微分的算法

中心差分公式
$$
f'(x)=\frac{f(x+h)-f(x-h)}{2h}
$$

$$
f''(x)=\frac{f(x+h)-2f(x)+f(x-h)}{h^2}
$$

### 数值积分的算法

两种矩形公式：

$$
L_n=h\sum_{k=0}^{n-1}{f_k} \space\space\space\space R_n=\sum_{k=1}^{n}{f_k}
$$
梯形公式：
$$
T_n=h\sum_{k=1}^{n-1}{f_k}+\frac{k}{2}(f_0+f_k)
$$
精度更高的辛普生公式：
$$
S_n=\frac{h}{3}(f_0+f_2n+2\sum_{k=1}^{n-1}{f_2k}+4\sum_{k=0}^{n-1}{f_(2k+1)})
$$
$$
h=\frac{a-b}{2n}
$$

$$
S=\frac{h}{6}(f(a)+4f(c)+f(b))
$$

a,d,c,e,b是区间[a, b]的均分点，得复合辛普森公式：
$$
S=\frac{h}{12}[f(a)+4f(d)+2f(c)+4f(e)+f(b)]
$$

![1557730677484](assets/1557730677484.png)

误差正比于$ h^p $ ,对辛普森法则，$ p=4$ 

Weddle 法则：求解$ Q-S=2^4(Q-S_2)$ ,得到：
$$
Q=S_2+(S_2-S)/15
$$
即六阶牛顿-柯斯特法则，龙贝格法则的第一步。

## 插值

### 插值的分类

* 内插
* 外插
* 多项式插值：拉格朗日，牛顿，埃尔米特
* 分段插值
* 样条插值：区间连接点也光滑
* 曲线拟合

### 拉格朗日插值法

过两点的直线：
$$
y=\frac{x-x_1}{x_0-x_1}y_0+\frac{x-x_0}{x_1-x_0}y_1
$$

$$
L_1(x)=l_0(x)y_0+l_1(x)y_1
$$

$ l_0, l_1$是线性插值基函数。二次插值函数：
$$
L_2(x)=l_0(x)y_0+l_1(x)y_1+l_2(x)y_2
$$
满足$ l_k(x_i)=\delta_{ik}$ 

![1557731348145](assets/1557731348145.png)

![1557731390207](assets/1557731390207.png)

### 分段三次埃尔米特插值

区间$ h_k=x_{k+1}-x_{k}$中插入一个三次多项式：
$$
P(x)=a_3x^3+a_2x^2+a_1x+a_0
$$
需要4个条件确定系数。取端点函数值和导数值：$y_k, y_{k+1}, d_k, d_{k+1}$ .局部变量$ s=x-x_k$ , 令$h=h_k$ .

![1557732733930](assets/1557732733930.png)

端点导数值的选择：

* 一阶导数相等：保形分段三次插值（pchip）的做法。（ pchip：分段三次埃尔米特插值多项式）

* 一阶和二阶导数都相等：三次样条插值函数( spline)的做法。

## 求方程的零点

### 对分法(二分法)

### 切线法

用对分法得到一个近似值后$x_n$，可以用切线法提高速度。

取泰勒级数的一级近似：
$$
f(x_n)+f'(x_n)(x-x_n)=0
$$
设$f'(x_n)\ne 0$, 以$x_{n+1}$  代替$x$ 得到牛顿迭代序列为：
$$
x_{n+1}=x_n-\frac{f(x_n)}{f'(x_n)}
$$
要求函数必须是光滑的，初始解接近精确解。

![1557733827091](assets/1557733827091.png)

### 弦割法

$$
f'(x_n)=\frac{f(x_n)-f(x_{n-1})}{x_n-x_{n-1}}
$$

$$
x_{n+1}=x_n-f(x_n)\frac{x_n-x_{n-1}}{f(x_n)-f(x_{n-1})}
$$

![1557733854222](assets/1557733854222.png)

## 解常微分方程

### 龙格-库塔法

#### 数值法解微分方程

$$
\begin{cases}
\dot{y}=f(t,y)\\
y(t_0)=y_0
\end{cases}
$$

步长$h=\frac{a-b}{n}$, 分为n个子区间：
$$
a=t_0<t_1<t_2...<t_n=b
$$
由中值定理：
$$
\frac{y(t_{i+1})-y(y_i)}{h}=\dot{y}(t_i+\theta h) \quad(0<\theta<1)
$$

$$
y(t_{i+1})=y(t_i)+k_{ave}h
$$

平均斜率：
$$
k_{ave}=f(t_i+\theta h,y(t_i+\theta h))
$$
在后面的各种方法实质上就是**确定平均斜率h**。

#### 欧拉法

$$
k_{ave}=f(t_i,y_i)
$$

取端点导数的平均值，得**改进的欧拉公式**：
$$
y_{i+1}=y_i+\frac{h}{2}(K_1+K_2)
$$
$K_2$是未知的，所以采用一种预报法进行计算。先用欧拉法求$y(t_{i+1})$:
$$
\bar{y}=y_i+hf(t_i,y_i)
$$
再用预报值求$K_2$.
$$
y_{i+1}=y_i+\frac{h}{2}[f(t_i,y_i)+f(t_{i+1},y_i+hf(t_i,y_i))]
$$

#### 一般的显式龙格-库塔法

$$
y_{i+1}=y_i+h\sum_{j=1}^{N}{\lambda_mK_m}
$$

$$
K_1=f(t_i,y_i)\\
K_m=f(t_i+\alpha h,y_i+h\sum_{j=1}^{m-1}{\beta_{mj}K_j})
$$

$\lambda_m, \alpha_m, \beta_{mj}$都是常数，确定常数的原则是使局部截断误差的阶数尽可能地高。

### 二阶龙格-库塔法

将边界点$t_i$替换为区间中的点：
$$
t_{i+p}=t_i+ph\quad(0<p\leq 1)\\
\bar{y}_{i+p}=y_i+phK_1\\
K_2=f(t_{i+p},\bar{y}_{i+p})\\
$$

$$
k_{ave}\approx\lambda_1K_1+\lambda_2K_2
$$

$$
\begin{cases}
K_1=f(t_i,y_i)\\
K_2=f(t_i+ph,y_i+phk_1)\\
y_{i+1}=y_i+h(\lambda_1K_1+\lambda_2K_2)
\end{cases}
$$

和泰勒展开式进行对比，若要局部截断误差达到$O(h^3)$，则要求：
$$
\lambda_1+\lambda_2=1,\quad\lambda_2p=1/2
$$
有无穷多解，都统称为二阶龙格-库塔公式。当
$$
\lambda_1=\lambda_2=1/2, p=1
$$
时，就是欧拉公式。如果取中点斜率为$K_2$，即
$$
p=1/2,\lambda_1=0,\lambda_2=1
$$
得到变形的欧拉公式（中点公式）。

### 三阶和四阶龙格-库塔法

$$
y_{i+1}=y_i+h(\lambda_1K_1+\lambda_2K_2+\lambda_3K_3)
$$

使局部截断误差为$O(h^4)$，参数条件：

![1557737767669](assets/1557737767669.png)

有无穷组解。其中一种：

![1557737807003](assets/1557737807003.png)

经典四阶方法：

![1557737841853](assets/1557737841853.png)

经典龙格-库塔法的总体截断误差是$O(h^4)$。

